{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원정보추가입력페이지</title>
    <link rel="stylesheet" href="{% static 'accounts/profile.css' %}">
</head>
<body>
    <div class="container">
        <div class="nav-bar">
            <div class="nav-left">
               
            </div>
            <div class="nav-right">
                {% comment %} <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 3L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2h-3.17L15 3H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
                </svg> {% endcomment %}
            </div>
        </div>
        
        {% comment %} <div class="header">
            회원정보추가입력페이지
        </div> {% endcomment %}
        
        <div class="content">
            <div class="instruction">
                더 나은 서비스를 위해<br>
                추가 정보를 입력해주세요.
            </div>

            <div class="profile-section">
                <div class="profile-picture">
                    <svg xmlns="http://www.w3.org/2000/svg" width="94" height="95" viewBox="0 0 94 95" fill="none">
                        <g clip-path="url(#clip0_357_1027)">
                            <path d="M47 82.75C66.468 82.75 82.25 66.968 82.25 47.5C82.25 28.032 66.468 12.25 47 12.25C27.532 12.25 11.75 28.032 11.75 47.5C11.75 66.968 27.532 82.75 47 82.75Z" fill="#180E19" stroke="#180E19" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M46.666 28.6666C54.2229 28.6668 60.3486 34.7933 60.3486 42.3502C60.3485 49.907 54.2228 56.0327 46.666 56.0328C39.1091 56.0328 32.9826 49.9071 32.9824 42.3502C32.9824 34.7932 39.109 28.6666 46.666 28.6666Z" fill="white" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <mask id="path-3-inside-1_357_1027" fill="white">
                            <path d="M23.5 69.0416C25.6719 64.7637 28.9859 61.1707 33.0748 58.6609C37.1637 56.1511 41.8677 54.8226 46.6654 54.8226C51.4631 54.8226 56.1671 56.1511 60.256 58.6609C64.3448 61.1707 67.6589 64.7637 69.8308 69.0416"/>
                            </mask>
                            <path d="M23.5 69.0416C25.6719 64.7637 28.9859 61.1707 33.0748 58.6609C37.1637 56.1511 41.8677 54.8226 46.6654 54.8226C51.4631 54.8226 56.1671 56.1511 60.256 58.6609C64.3448 61.1707 67.6589 64.7637 69.8308 69.0416" fill="white"/>
                            <path d="M22.1625 68.3626C21.7875 69.1013 22.0823 70.0041 22.821 70.3791C23.5596 70.7542 24.4625 70.4594 24.8375 69.7207L23.5 69.0416L22.1625 68.3626ZM68.4933 69.7207C68.8683 70.4594 69.7711 70.7542 70.5098 70.3791C71.2485 70.0041 71.5433 69.1013 71.1683 68.3626L69.8308 69.0416L68.4933 69.7207ZM23.5 69.0416L24.8375 69.7207C26.884 65.6897 30.0067 62.3042 33.8595 59.9393L33.0748 58.6609L32.2901 57.3825C27.9652 60.0372 24.4598 63.8377 22.1625 68.3626L23.5 69.0416ZM33.0748 58.6609L33.8595 59.9393C37.7123 57.5744 42.1447 56.3226 46.6654 56.3226V54.8226V53.3226C41.5907 53.3226 36.6151 54.7279 32.2901 57.3825L33.0748 58.6609ZM46.6654 54.8226V56.3226C51.1861 56.3226 55.6185 57.5744 59.4713 59.9393L60.256 58.6609L61.0406 57.3825C56.7157 54.7279 51.7401 53.3226 46.6654 53.3226V54.8226ZM60.256 58.6609L59.4713 59.9393C63.3241 62.3042 66.4468 65.6897 68.4933 69.7207L69.8308 69.0416L71.1683 68.3626C68.871 63.8377 65.3656 60.0372 61.0406 57.3825L60.256 58.6609Z" fill="white" mask="url(#path-3-inside-1_357_1027)"/>
                        </g>
                        <defs>
                            <clipPath id="clip0_357_1027">
                            <rect width="94" height="94" fill="white" transform="translate(0 0.5)"/>
                            </clipPath>
                        </defs>
                     </svg>
                </div>
                <button type="button" class="change-picture" onclick="document.getElementById('profile_image').click()">Change picture</button>
                <input type="file" id="profile_image" class="hidden" accept="image/*">
            </div>

            <form class="form-section" method="POST">
                {% csrf_token %}
                
                <div class="form-group">
                    <label class="form-label">닉네임</label>
                    <input 
                        type="text" 
                        class="input-field" 
                        name="nickname" 
                        placeholder="닉네임을 설정해주세요"
                        value="{{ profile.nickname|default:'' }}"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">성별</label>
                    <div class="gender-buttons">
                        <button type="button" class="gender-btn" data-value="F">여성</button>
                        <button type="button" class="gender-btn" data-value="M">남성</button>
                    </div>
                    <input type="hidden" name="user_gender" id="user_gender" value="{{ profile.user_gender|default:'' }}">
                </div>

                <div class="form-group">
                    <label class="form-label">나이</label>
                    <input 
                        type="number" 
                        class="input-field" 
                        name="user_age" 
                        placeholder="나이를 작성해주세요."
                        value="{{ profile.user_age|default:'' }}"
                    >
                </div>

                <button type="submit" class="complete-btn">완료</button>
            </form>
        </div>
    </div>

    <script>
        // 성별 버튼 선택 기능
        document.querySelectorAll('.gender-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // 모든 버튼에서 selected 클래스 제거
                document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('selected'));
                // 클릭된 버튼에 selected 클래스 추가
                this.classList.add('selected');
                // hidden input에 값 설정
                document.getElementById('user_gender').value = this.dataset.value;
            });
        });

        // 기존 성별 값이 있으면 해당 버튼 선택
        const currentGender = document.getElementById('user_gender').value;
        if (currentGender) {
            document.querySelector(`[data-value="${currentGender}"]`).classList.add('selected');
        }

        // 프로필 이미지 업로드 처리
        document.getElementById('profile_image').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const profilePicture = document.querySelector('.profile-picture');
                    profilePicture.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // 폼 제출 처리
        document.querySelector('form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            try {
                const response = await fetch('', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('프로필이 성공적으로 업데이트되었습니다.');
                    // 성공 시 리다이렉트 또는 다른 처리
                } else {
                    alert(result.error || '오류가 발생했습니다.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('오류가 발생했습니다.');
            }
        });
    </script>
</body>
</html>