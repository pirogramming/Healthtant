{% extends 'base/base.html' %}
{% load static %}

{% block title %}마이페이지{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'mypage/mypage_profile.css' %}">
{% endblock %}

{% block header_title %}
<!-- 헤더 제목 영역을 비워서 기본 제목 숨기기 -->
{% endblock %}

{% block header_extra %}
<!-- 뒤로가기 버튼 추가 -->
<button class="back-button" onclick="window.location.href='{% url 'main:main_page' %}'">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M15 18L9 12L15 6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
</button>
{% endblock %}

{% block content %}
<div class="content">
    <!-- 프로필 이미지 섹션 -->
    <div class="profile-picture-section">
        <div class="profile-picture-container">
            <div class="profile-picture">
                {% if user_data.profile_image_url %}
                    <img src="{{ user_data.profile_image_url }}" alt="프로필 이미지">
                {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="94" height="95" viewBox="0 0 94 95" fill="none">
                        <g clip-path="url(#clip0_357_1027)">
                            <path d="M47 82.75C66.468 82.75 82.25 66.968 82.25 47.5C82.25 28.032 66.468 12.25 47 12.25C27.532 12.25 11.75 28.032 11.75 47.5C11.75 66.968 27.532 82.75 47 82.75Z" fill="black" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M46.666 28.6666C54.2229 28.6668 60.3486 34.7933 60.3486 42.3502C60.3485 49.907 54.2228 56.0327 46.666 56.0328C39.1091 56.0328 32.9826 49.9071 32.9824 42.3502C32.9824 34.7932 39.109 28.6666 46.666 28.6666Z" fill="white" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M23.5 69.0416C25.6719 64.7637 28.9859 61.1707 33.0748 58.6609C37.1637 56.1511 41.8677 54.8226 46.6654 54.8226C51.4631 54.8226 56.1671 56.1511 60.256 58.6609C64.3448 61.1707 67.6589 64.7637 69.8308 69.0416" fill="white"/>
                        </g>
                        <defs>
                            <clipPath id="clip0_357_1027">
                                <rect width="94" height="94" fill="white" transform="translate(0 0.5)"/>
                            </clipPath>
                        </defs>
                    </svg>
                {% endif %}
            </div>
        </div>
        <button class="edit-profile-button" onclick="goToProfilePage()">수정하기</button>
    </div>

    <!-- 사용자 정보 섹션 -->
    <div class="user-info-section">
        <div class="info-row">
            <span class="info-label">닉네임</span>
            <span class="info-value">@{{ user_data.nickname }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">이름</span>
            <span class="info-value">{{ user_data.user_name }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">나이</span>
            <span class="info-value">{{ user_data.user_age }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">성별</span>
            <span class="info-value">
                {% if user_data.user_gender == 'M' %}남자{% else %}여자{% endif %}
            </span>
        </div>
    </div>

    <!-- 즐겨찾는 제품 섹션 -->
    <div class="section">
        <div class="favorite-card" onclick="window.location.href='{% url 'mypage:favorite_food_list' %}'">
            <div class="favorite-content">
                <div class="favorite-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5C22 12.28 18.6 15.36 13.45 20.04L12 21.35Z" fill="white"/>
                    </svg>
                </div>
                <div class="favorite-info">
                    <h3 class="favorite-title">즐겨찾는 제품</h3>
                    <p class="favorite-subtitle">나만의 건강한 식품들</p>
                </div>
            </div>
            <div class="favorite-arrow">
                <span class="arrow-text">보기</span>
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M7.5 15L12.5 10L7.5 5" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- 로그아웃/탈퇴 섹션 -->
    <div class="section">
        <button class="section-title" onclick="confirmLogout()">로그아웃</button>
        <p class="withdrawal-text"
            onclick="window.location.href='{% url 'mypage:account_withdraw' %}'">
            탈퇴하기
        </p>
    </div> 
</div>
{% endblock %}

{% block bottom_navigation %}
{% endblock %}

{% block extra_js %}
<script>
    window.isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};
    window.serverImageUrl = '{{ user_data.profile_image_url }}';
</script>
<script src="{% static 'mypage/js/mypage.js' %}"></script>

{% endblock %}
