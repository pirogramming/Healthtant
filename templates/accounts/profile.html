{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원정보추가입력페이지</title>
    <link rel="stylesheet" href="{% static 'accounts/profile.css' %}">
    <link rel="stylesheet" href="{% static 'base/variables.css' %}">
    <link rel="stylesheet" href="{% static 'base/base.css' %}">
</head>
<body>
    <div class="container">
        <div class="nav-bar">
            <div class="nav-left">
            </div>
            <div class="nav-right">
            </div>
        </div>

        
        <div class="content">
            <div class="instruction">
                더 나은 서비스를 위해<br>
                추가 정보를 입력해주세요.
            </div>

                <form class="form-section" method="POST" enctype="multipart/form-data" action="/accounts/profile/">
                    {% csrf_token %}

                    <div class="profile-section">
                        <div class="profile-picture" aria-label="프로필 이미지">
                            {% if user.profile_image %}
                                <img src="{{ user.profile_image.url }}" alt="프로필 이미지">
                            {% elif user.profile_image_url %}
                                <img src="{{ user.profile_image_url }}" alt="프로필 이미지">
                            {% else %}
                                <img style="width : 94px; height : 94px; border-radius: 50%; border: 2px solid rgba(248, 248, 248, 1); " src="{% static 'images/default.png' %}" alt="기본 프로필 이미지">
                            {% endif %}
                        </div>
                        <button type="button" class="change-picture" onclick="document.getElementById('profile_image').click()">
                        Change picture
                        </button>
                        <input type="file" id="profile_image" name="profile_image" class="hidden" accept="image/*">
                    </div>

                    <!-- 나머지 필드들 -->
                    <div class="form-group">
                        <label class="form-label">닉네임</label>
                        <input type="text" class="input-field" name="nickname" value="{{ profile.nickname|default:'' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">성별</label>
                        <div class="gender-buttons">
                        <button type="button" class="gender-btn" data-value="F">여성</button>
                        <button type="button" class="gender-btn" data-value="M">남성</button>
                        </div>
                        <input type="hidden" name="user_gender" id="user_gender" value="{{ profile.user_gender|default:'' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">나이</label>
                        <input type="number" class="input-field" name="user_age" value="{{ profile.user_age|default:'' }}">
                    </div>

                    <button type="submit" class="complete-btn">완료</button>
                    </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
    // 성별 버튼 선택
    const genderBtns = document.querySelectorAll('.gender-btn');
    const genderInput = document.getElementById('user_gender');
    genderBtns.forEach(btn => {
        btn.addEventListener('click', () => {
        genderBtns.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        genderInput.value = btn.dataset.value;
        });
    });
    // 기존 값 표시
    const current = genderInput.value;
    if (current) {
        const active = document.querySelector(`.gender-btn[data-value="${current}"]`);
        if (active) active.classList.add('selected');
    }

    // 프로필 이미지 미리보기
    document.getElementById('profile_image').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
        document.querySelector('.profile-picture').innerHTML =
            `<img src="${ev.target.result}" alt="프로필 이미지" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
        };
        reader.readAsDataURL(file);
    });

    // 폼 제출 UX (기본 제출 유지)
    const form = document.querySelector('.form-section');
    const submitBtn = document.querySelector('.complete-btn');
    form.addEventListener('submit', () => {
        submitBtn.disabled = true;
        submitBtn.textContent = '저장 중...';
    });
    });
    </script>
</body>
</html>