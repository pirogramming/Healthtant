{% extends 'base.html' %}
{% load static %}

{% block title %}ì‹ì‚¬ë“±ë¡í˜ì´ì§€ - HEALTHTANT{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'diets/diets_register.css' %}">
{% endblock %}

{% block header %}
<header class="app-header">
    <div class="status-bar"></div>
    <div class="search-section">
        <div class="search-container">
            <button type="button" class="search-input" onclick="performSearch()">
                <span class="search-placeholder">ìƒˆ ì œí’ˆì„ ê²€ìƒ‰í•´ì„œ ì°¾ì•„ë³´ì„¸ìš”</span>
                <div class="search-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.183 3.62741C6.11475 3.62741 3.62744 6.11472 3.62744 9.18297C3.62744 12.2512 6.11475 14.7385 9.183 14.7385C10.6756 14.7385 12.0307 14.1499 13.0289 13.1921C13.0525 13.1622 13.0781 13.1334 13.1058 13.1057C13.1334 13.0781 13.1622 13.0525 13.1922 13.0289C14.1499 12.0307 14.7386 10.6756 14.7386 9.18297C14.7386 6.11472 12.2512 3.62741 9.183 3.62741ZM15.146 13.7594C16.1202 12.492 16.6993 10.9051 16.6993 9.18297C16.6993 5.03181 13.3342 1.66663 9.183 1.66663C5.03184 1.66663 1.66666 5.03181 1.66666 9.18297C1.66666 13.3341 5.03184 16.6993 9.183 16.6993C10.9052 16.6993 12.492 16.1201 13.7595 15.1459L16.6597 18.0461C17.0426 18.429 17.6633 18.429 18.0462 18.0461C18.429 17.6633 18.429 17.0425 18.0462 16.6597L15.146 13.7594Z" fill="#56AAB2"/>
                    </svg>
                </div>
            </button>
        </div>
        <button class="cancel-btn" onclick="clearSearch()">ì·¨ì†Œ</button>
    </div>
</header>
{% endblock %}

{% block bottom_navigation %}{% endblock %}

{% block content %}

<div class="meal-register-container">
    <!-- ê³¼ê±° ì„­ì·¨ ì œí’ˆ ëª©ë¡ -->
    <div class="recent-foods-section">
        <h2>ê³¼ê±°ì— ì„­ì·¨í•œ ì œí’ˆëª©ë¡</h2>
        <div class="recent-foods-list">
            {% for food in recent_foods %}
            <div class="food-card" data-food-id="{{ food.food_id }}">
                <div class="food-image">
                    {% if food.food_img %}
                        <img src="{{ food.food_img }}" alt="{{ food.food_name }}">
                    {% else %}
                        <img src="{% static 'diets/images/default-food.jpg' %}" alt="{{ food.food_name }}">
                    {% endif %}
                </div>
                <div class="food-info">
                    <h3 class="food-name">{{ food.food_name }}</h3>
                    <p class="food-company">ì œì¡°ì‚¬: {{ food.company_name }}</p>
                </div>
                <button class="register-btn" onclick="registerFood('{{ food.food_id }}')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">ë“±ë¡í•˜ê¸°</span>
                </button>
            </div>
            {% empty %}
            <!-- ë¹ˆ ìƒíƒœ: ìµœê·¼ ì„­ì·¨ ì œí’ˆì´ ì—†ì„ ë•Œ -->
            <div class="empty-state">
                <div class="empty-icon">ğŸ”</div>
                <div class="empty-title">ìµœê·¼ì— ë“±ë¡í•œ ì œí’ˆì´ ì—†ì–´ìš”</div>
                <div class="empty-sub">ìƒë‹¨ì˜ ê²€ìƒ‰ì„ ëˆŒëŸ¬ ì œí’ˆì„ ì°¾ì•„ ë“±ë¡í•´ë³´ì„¸ìš”.</div>
                <button class="register-btn" type="button" onclick="performSearch()">
                    <span class="plus-icon">+</span>
                    <span class="register-text">ìƒˆ ì œí’ˆ ê²€ìƒ‰í•˜ëŸ¬ ê°€ê¸°</span>
                </button>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function performSearch() {
    // ê²€ìƒ‰ í˜ì´ì§€ë¡œ ì´ë™
    window.location.href = '/diets/search/page/';
}

function clearSearch() {
    // diets_main.htmlë¡œ ì´ë™ (ì˜¤ëŠ˜ ë‚ ì§œë¡œ)
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1;
    
    window.location.href = `/diets/?year=${year}&month=${month}`;
}

function registerFood(foodId) {
    // ì˜¤ëŠ˜ ë‚ ì§œ ìƒì„±
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');
    const todayString = `${year}-${month}-${day}`;
    
    // diets_upload.htmlë¡œ ì´ë™ (food_idì™€ ì˜¤ëŠ˜ ë‚ ì§œë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬)
    window.location.href = `/diets/upload/?food=${foodId}&date=${todayString}`;
}
</script>
{% endblock %}