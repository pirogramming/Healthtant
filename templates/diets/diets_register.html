{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>식사등록페이지 - Healthtant</title>
    <link rel="stylesheet" href="{% static 'diets/diets_register.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
<header class="app-header">
    <div class="status-bar"></div>
    
    <!-- 뒤로가기 버튼 + 제목 -->
    {% comment %} <div class="header-nav">
        <button class="back-button" onclick="history.back()" aria-label="뒤로가기">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <h1 class="page-title">
            {% block page_title %}분석하기{% endblock %}
        </h1>
    </div> {% endcomment %}
    <div class="search-section">
        <div class="search-container">
            <button type="button" class="search-input" onclick="performSearch()">
                <span class="search-placeholder">새 제품을 검색해서 찾아보세요</span>
                <div class="search-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.183 3.62741C6.11475 3.62741 3.62744 6.11472 3.62744 9.18297C3.62744 12.2512 6.11475 14.7385 9.183 14.7385C10.6756 14.7385 12.0307 14.1499 13.0289 13.1921C13.0525 13.1622 13.0781 13.1334 13.1058 13.1057C13.1334 13.0781 13.1622 13.0525 13.1922 13.0289C14.1499 12.0307 14.7386 10.6756 14.7386 9.18297C14.7386 6.11472 12.2512 3.62741 9.183 3.62741ZM15.146 13.7594C16.1202 12.492 16.6993 10.9051 16.6993 9.18297C16.6993 5.03181 13.3342 1.66663 9.183 1.66663C5.03184 1.66663 1.66666 5.03181 1.66666 9.18297C1.66666 13.3341 5.03184 16.6993 9.183 16.6993C10.9052 16.6993 12.492 16.1201 13.7595 15.1459L16.6597 18.0461C17.0426 18.429 17.6633 18.429 18.0462 18.0461C18.429 17.6633 18.429 17.0425 18.0462 16.6597L15.146 13.7594Z" fill="#56AAB2"/>
                    </svg>
                </div>
            </button>
        </div>
        <button class="cancel-btn" onclick="clearSearch()">취소</button>
    </div>
</header>

<div class="meal-register-container">
    {% comment %} <div class="header">
        <div class="status-bar"></div>  
    </div> {% endcomment %}


    <!-- 과거 섭취 제품 목록 -->
    <div class="recent-foods-section">
        <h2>과거에 섭취한 제품목록</h2>
        <div class="recent-foods-list">
            {% for food in recent_foods %}
            <div class="food-card" data-food-id="{{ food.food_id }}">
                <div class="food-image">
                    {% if food.food_img %}
                        <img src="{{ food.food_img }}" alt="{{ food.food_name }}">
                    {% else %}
                        <img src="{% static 'diets/images/default-food.jpg' %}" alt="{{ food.food_name }}">
                    {% endif %}
                </div>
                <div class="food-info">
                    <h3 class="food-name">{{ food.food_name }}</h3>
                    <p class="food-company">제조사: {{ food.company_name }}</p>
                </div>
                <button class="register-btn" onclick="registerFood('{{ food.food_id }}')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>
            {% empty %}
            <!-- Mock 데이터 (실제 데이터가 없을 때) -->
            <div class="food-card" data-food-id="food001">
                <div class="food-image">
                    <img src="https://image.example.com/food001.jpg" alt="하림 닭가슴살 블랙페퍼">
                </div>
                <div class="food-info">
                    <h3 class="food-name">하림 닭가슴살 블랙페퍼, 800g, 1개</h3>
                    <p class="food-company">제조사: CJ대원푸드</p>
                </div>
                <button class="register-btn" onclick="registerFood('food001')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>

            <div class="food-card" data-food-id="food002">
                <div class="food-image">
                    <img src="https://image.example.com/food002.jpg" alt="득근파티 통 닭가슴살 6종 혼합">
                </div>
                <div class="food-info">
                    <h3 class="food-name">득근파티 통 닭가슴살 6종 혼합, 100g</h3>
                    <p class="food-company">제조사: CJ대원푸드</p>
                </div>
                <button class="register-btn" onclick="registerFood('food002')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>

            <div class="food-card" data-food-id="food003">
                <div class="food-image">
                    <img src="https://image.example.com/food003.jpg" alt="하림 닭가슴살 블랙페퍼">
                </div>
                <div class="food-info">
                    <h3 class="food-name">하림 닭가슴살 블랙페퍼, 800g, 1개</h3>
                    <p class="food-company">제조사: CJ대원푸드</p>
                </div>
                <button class="register-btn" onclick="registerFood('food003')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>

            <div class="food-card" data-food-id="food004">
                <div class="food-image">
                    <img src="https://image.example.com/food004.jpg" alt="하림 닭가슴살 블랙페퍼">
                </div>
                <div class="food-info">
                    <h3 class="food-name">하림 닭가슴살 블랙페퍼, 800g, 1개</h3>
                    <p class="food-company">제조사: CJ대원푸드</p>
                </div>
                <button class="register-btn" onclick="registerFood('food004')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>

            <div class="food-card" data-food-id="food005">
                <div class="food-image">
                    <img src="https://image.example.com/food005.jpg" alt="하림 닭가슴살 블랙페퍼">
                </div>
                <div class="food-info">
                    <h3 class="food-name">하림 닭가슴살 블랙페퍼, 800g, 1개</h3>
                    <p class="food-company">제조사: CJ대원푸드</p>
                </div>
                <button class="register-btn" onclick="registerFood('food005')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>

            <div class="food-card" data-food-id="food006">
                <div class="food-image">
                    <img src="https://image.example.com/food006.jpg" alt="하림 닭가슴살 블랙페퍼">
                </div>
                <div class="food-info">
                    <h3 class="food-name">하림 닭가슴살 블랙페퍼, 800g, 1개</h3>
                    <p class="food-company">제조사: CJ대원푸드</p>
                </div>
                <button class="register-btn" onclick="registerFood('food006')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>

            <div class="food-card" data-food-id="food007">
                <div class="food-image">
                    <img src="https://image.example.com/food007.jpg" alt="하림 닭가슴살 블랙페퍼">
                </div>
                <div class="food-info">
                    <h3 class="food-name">하림 닭가슴살 블랙페퍼, 800g, 1개</h3>
                    <p class="food-company">제조사: CJ대원푸드</p>
                </div>
                <button class="register-btn" onclick="registerFood('food007')">
                    <span class="plus-icon">+</span>
                    <span class="register-text">등록하기</span>
                </button>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
function performSearch() {
    // 검색 페이지로 이동
    window.location.href = '/diets/search/page/';
}

function clearSearch() {
    // diets_main.html로 이동 (오늘 날짜로)
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1;
    
    window.location.href = `/diets/?year=${year}&month=${month}`;
}

function registerFood(foodId) {
    // 오늘 날짜 생성
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');
    const todayString = `${year}-${month}-${day}`;
    
    // diets_upload.html로 이동 (food_id와 오늘 날짜를 파라미터로 전달)
    window.location.href = `/diets/upload/?food=${foodId}&date=${todayString}`;
}
</script>
</body>
</html>